syntax = "proto3";

package framework;

option go_package = "github.com/lk2023060901/xiaojia-proto-framework;framework";

import "err_code.proto";

// VerifyTokenReq Gateway 向 Login 验证 Token 请求
//
// 使用场景：
//   1. 客户端连接 Gateway 后，携带 Token 进行认证
//   2. Gateway 收到 Token 后，向 Login 服务验证有效性
//
message VerifyTokenReq {
  // 客户端提供的 Token
  string token = 1;

  // 客户端 IP（用于安全校验，可选）
  string client_ip = 2;

  // 设备 ID（用于多端登录控制，可选）
  string device_id = 3;
}

// VerifyTokenRsp Login 返回的验证结果
message VerifyTokenRsp {
  // 错误码
  ErrCode code = 1;

  // 错误信息（当 code != ERR_SUCCESS 时）
  string message = 2;

  // 用户 ID（验证成功时返回）
  uint64 user_id = 3;

  // 用户唯一标识（验证成功时返回）
  string user_uuid = 4;

  // Token 剩余有效时间（秒）
  int64 ttl = 5;

  // 用户附加信息
  UserInfo user_info = 6;
}

// UserInfo 用户基础信息
message UserInfo {
  // 昵称
  string nickname = 1;

  // 头像 URL
  string avatar = 2;

  // 账号等级/VIP 等级
  int32 level = 3;

  // 扩展字段（JSON 格式，业务自定义）
  string extra = 10;
}

// GetUserProfileReq 获取用户信息请求
message GetUserProfileReq {
  string user_uuid = 1;
}

// GetUserProfileRsp 获取用户信息响应
message GetUserProfileRsp {
  ErrCode code = 1;
  string message = 2;
  UserInfo user_info = 3;
}

// AuthService 认证服务 (内部 RPC)
service AuthService {
  // VerifyToken 验证 Token 合法性 (由 Gateway 调用)
  rpc VerifyToken(VerifyTokenReq) returns (VerifyTokenRsp);

  // GetUserProfile 获取用户资料 (由业务服调用)
  rpc GetUserProfile(GetUserProfileReq) returns (GetUserProfileRsp);
}
